{% extends "model_detail.html" %}

{% load custom_tags %}

{% block posttable %} 

<div>
    
    <div id="fig" style="width:100%;height:300px;"></div>

    <script>
        var fig = {{ fig|safe }};
        var config = { responsive: true }
        Plotly.newPlot('fig', fig.data, fig.layout, config);

        // Add click event listener
        document.getElementById("fig").on('plotly_click', function(data){
            var pointIndex = data.points[0].pointIndex;
            var pose_id = data.points[0].customdata[0];
            window.open(`/pose/${pose_id}/?inspirations=True&poseset_redirect={{object.pk}}`, '_blank');
        });

    </script>

</div>

{% endblock %}

{% block precards %} 

{% if uncertain_poses %}

<div class="card">
    
    <table>

        <h2 class="title">Poses to review next</h2>
        
        <tr>
            <th>Pose</th>
            <th style="text-align:right;">Predicted Score</th>
            <th style="text-align:right;">Uncertainty</th>
        
        {% for member in uncertain_poses %}
        
        <tr>
            <td><a href="{% url 'pose_detail' member.pose.pk %}?inspirations=True&poseset_redirect={{object.pk}}" target="_blank" rel="noopener noreferrer">{{member.pose.model_pill_html|safe}}</a></td>
            <td style="text-align:right;"><span class="monospace">{{ member.predicted_score|floatformat:2 }}</span></td>
            <td style="text-align:right;"><span class="monospace">{{ member.prediction_uncertainty|floatformat:2 }}</span></td>
        </tr>
        
        {% endfor %}

    </table>

</div>

{% endif %}

{% endblock %}