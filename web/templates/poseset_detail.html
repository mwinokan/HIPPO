{% extends "model_detail.html" %}

{% load custom_tags %}

{% block posttable %} 

<div>
    
    <div id="fig" style="width:100%;height:300px;"></div>

    <script>
        var fig = {{ fig|safe }};
        var config = { responsive: true }
        Plotly.newPlot('fig', fig.data, fig.layout, config);

        // Add click event listener
        document.getElementById("fig").on('plotly_click', function(data){
            var pointIndex = data.points[0].pointIndex;
            var pose_id = data.points[0].customdata;

            document.getElementById("form").style.display = "block";
            
            document.getElementById("pose_id_input").value = pose_id;

            fetch(`/pose_compare_3d/${pose_id}?inspirations=True&model_pills=True`)
            .then(response => response.text())
            .then(data => {
                document.getElementById("selected_viewer").innerHTML = data;
                const scripts = document.querySelectorAll("#selected_viewer script");
                scripts.forEach(script => {
                    const newScript = document.createElement("script");
                    newScript.text = script.textContent;
                    document.head.appendChild(newScript);
                    script.remove();
                });
            })
            .catch(error => console.error("Error loading content:", error));
        });

    </script>

</div>

{% endblock %}

{% block precards %} 

<div class="card">

    <h2>Selected</h2>

    <div id="selected_viewer"></div>

    <form id="form" style="display:none;" method="post">
        {% csrf_token %}

        <label for="related_model">Pose:</label>
        <input type="number" name="pose" id="pose_id_input" value="1" required readonly>

        <label for="review">Review:</label>
        <select name="review" id="review">
            <option value="GOOD" selected>GOOD</option>
            <option value="BAD">BAD</option>
        </select>
    <button type="submit">Update</button>
</form>

</div>

{% endblock %}