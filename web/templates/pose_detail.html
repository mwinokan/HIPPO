{% extends "model_detail.html" %}

{% load custom_tags %}

{% block pretable %} 

<br>

<div class="monospace" style="padding:0;">
    <div id="viewer" style="width: 100%; height: 400px; position: relative;"></div>
</div>

<script>
    let sdfUrl = "{% url 'pose_sdf' object.pk %}";  // Fetch SDF

    fetch(sdfUrl)
        .then(response => response.text())
        .then(sdfData => {
            let viewer = $3Dmol.createViewer("viewer");
            viewer.addModel(sdfData, "sdf");  // Add SDF model
            viewer.setBackgroundColor("a7cfee", 0.0)
            viewer.setStyle({}, { stick: {} });  // Stick representation
            viewer.setStyle({ elem: "C" }, { stick: { color: "white" } });  // recolor carbons
            viewer.zoomTo();  // Zoom to molecule
            viewer.render();  // Render the molecule
        })
        .catch(error => console.error("Error loading SDF:", error));

</script>

{% endblock %}

{% block precards %}

<div class="card">
    
    <table>

        <h2 class="title">Tags</h2>
        
        <tr>
            <th>Tag</th>
            <th>Type</th>
            <th>Origin</th>
        
        {% for posetag in object.tags.all %}
        
        <tr>
            <td><a href="{% url 'tag_detail' posetag.tag.pk %}">{{ posetag.tag.model_pill_html|safe }}</a></td>
            <!-- <td><span class="monospace">{{ posetag.tag.name }}</span></td> -->
            <td><span class="monospace">{{ posetag.tag.type.name }}</span></td>
            <td><span class="monospace">{{ posetag.tag.type.origin }}</span></td>
        </tr>
        
        {% endfor %}

    </table>

</div>


{% endblock %}